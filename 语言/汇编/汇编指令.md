# ARM汇编基础知识

| `寄存器`  | `说明`           |
| --------- | ---------------- |
| `R0`      |                  |
| `R1`      |                  |
| `R2`      |                  |
| `R3`      |                  |
| `R4`      |                  |
| `R5`      |                  |
| `R6`      |                  |
| `R7`      |                  |
| `R8`      |                  |
| `R9`      |                  |
| `R10`     |                  |
| `R11`     |                  |
| `R12`     |                  |
| `R13(SP)` | 堆栈指针         |
| `R14(LR)` | 子程序连接寄存器 |
| `R15(PC)` | 程序计数器       |
|           |                  |
|           |                  |
|           |                  |
|           |

`IRQ` - 外部中断
`FIQ` - 快速中断

---

`MRS` 读取: 通用寄存器 <-- 状态寄存器
`MSR` 写回: 状态寄存器 <-- 通用寄存器

```asm
MRS R0, CPSR        ; CPSR 的值复制到 R0
ORR R0, R0, #C0     ; R0 的 位6 和 位7 置 1, 即屏蔽外部中断和快速中断
MSR CPSR, R0        ; R0 的值复制到 CPSR
```

---

## ARM指令

### 跳转指令

`LDR`

- `LDR, [PC, # + 0x00FF]`
  - `PC ← [PC + 8 + 0x00FF]`
  - 可以实现4G地址孔家你的跳转

`B`

```asm
B WAITA     ; 跳转到 标号 `WAITA` 处执行
B 0x1234    ; 跳转到 地址 `0x1234` 处执行
```

`BL`

- `BL FUNC1`
  - 将下一条指令复制到`R14(LR)`中
  - 跳转到 `FUNC1`

`BLX`

- `BLX FUNC1`
  - 将下一条指令复制到`R14(LR)`中
  - 跳转到 `FUNC1`
  - 处理器工作状态切换到 `Thumb` 模式
- `BLX R0`
  - 将下一条指令复制到`R14(LR)`中
  - 跳转到 `R0` 中的地址处执行
  - 处理器工作状态切换到 `Thumb` 模式

`BX`

- `BX R0`
  - 若 `R0位[0] == 1`
    - 切换到 `Thumb` 模式
    - `CPSR` 的 `T` 标志位置1
    - `R0位[31:1]` 复制到 `PC` 中
  - 若 `R0位[0] == 0`
    - 切换为 ARM 状态
    - `CPSR` 的 `T` 标志位清0
    - `R0位[31:1]` 复制到 `PC` 中

---

### 数据处理指令

#### MOV

| `指令` | `备注1`                             |
| ------ | ----------------------------------- |
| `BNE`  | 不相等就跳转                        |
| `ADD`  | `ADD R0, R0 #1` 表示 `R0 <- R0 + 1` |
| `STR`  | `STR R0 [R1]` 表示 `R0 -> [R1]`         |
| `LDR`  | `STR R0 [R1]` 表示 `R0 <- [R1]`         |
| `MOV`  | `STR R0 R1` 表示 `R0 <- R1`         |
|        |                                     |
